# 2022-05

## 2022-05-12
### Ellipsis 组件开发心得
**目标**：多行文本省略，需要支持末尾尾随`展开`和`收起`按钮。

**思路**：分为两种情况，一种情况为普通文本省略，可以通过 `css` 属性来设置。另一种情况是需要支持末尾`展开`按钮，需要计算文本宽度是否超出已有宽度。

**实现**：

 - 普通文本省略：

```css
// 单行省略
.single-line-ellipsis {
   white-space: no-wrap;
   overflow: hidden;
   text-overflow: ellipsis;
}

// 多行省略
.multiple-line-ellipsis {
   display: --webkit-box;
   overflow: hidden;
   --webkit-line-clamp: 3; // 行数
   --webkit-box-orient: vertical;
}
```

 - 文本尾随`展开`按钮省略：

   1. 首先，需要计算文本是否超过了宽度`width`。
      1. 计算文本渲染的高度：通过一个“隐藏”的 span 标签 **自由换行** 加载文本，加载完成后得到文本高度。
      2. 计算单行文本渲染高度。通过一个“隐藏”的 span 标签 **不换行** 加载文本，加载完成后得到文本高度。
      3. 通过用户提供的行数`rows`判断 `行数 * 单行高度 是否大于 多行高度 `，如果大于则说明 **文本超出**。
   2. 文本超出后，切割文本。
      1. 计算文本总长度，如果非字符串和数字，当做一个字符，记录长度为1。
      2. 通过二分法切割文本。
      3. 将切割后的文本通过步骤 1 进行渲染。看是否满足要求。
   3. 响应式处理。
      1. 监听文本变化，当文本或宽度等发生变化时，判断是否需要重新计算省略内容。

**注意点**：

- 获取元素高度时，通过`offsetHeight`获取的高度为`height + padding + border`，并且为整数。因此在行高不为整数时，会出现计算上的一些误差。


## 2022-05-13

### Vim 配置主题
配置颜色主题：[onedark](https://github.com/milesj/dotfiles/blob/master/vim/colors/onedark.vim)

通过 `.vimrc` 文件开启颜色配置。
``` vim
syntax on
colorscheme onedark
```

## 2022-05-18

### unpkg.com
[unpkg.com](https://unpkg.com/)： 通过 `cdn` 的方式获取 `npm` 包及文件。

### stub 概念
[来自 antfu](https://antfu.me/posts/publish-esm-and-cjs)
参见 `jiti` 包：通常情况下，运行一个文件比如 `ts` 文件，需要先打包然后再运行。而 `stub` 相当于去除了直接打包的步骤，在程序需要运行时，再将代码编译执行。

### 前端埋点
[来自网易云](https://github.com/x-orpheus/blog/blob/master/content/blog/web-track.md)
- 元素点击埋点：
```jsx
<TrackerClick name='namespace.click'>
{
   ({ handleClick }) => <button onClick={handleClick}>点击坑位</button>
}
</TrackerClick>
```
- 元素曝光埋点：
借助 `IntersectionObservers` `api` 监听元素进入或离开视口的事件。
```jsx
<TrackerExposure
   name='pagination.impress'
   extra={{ modulePosition: i + 1 }}
>
   {({ addRef }) => <div ref={addRef}>{i + 1}</div>}
</TrackerExposure>
```
- 页面曝光埋点：
封装 `track` 方法，手动在生命周期里记录页面曝光。同理也可以手动记录事件回调。 

## 2022-05-19

###
