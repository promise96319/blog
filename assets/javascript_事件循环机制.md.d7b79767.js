import{_ as s,c as n,o as a,a as l}from"./app.788a9091.js";const o="/assets/event-loop-callstack.3a273915.png",p="/assets/memory-overflowing.cfd2acd5.png",e="/assets/event-loop-overview.74d2993b.png",t="/assets/macrotask-microtask.9f41bfe2.png",c="/assets/browser-async-excute-animate.b91bcdb7.gif",u=JSON.parse('{"title":"事件循环、微任务与宏任务","description":"","frontmatter":{},"headers":[{"level":2,"title":"单线程的优缺点","slug":"单线程的优缺点","link":"#单线程的优缺点","children":[]},{"level":2,"title":"调用栈和任务队列","slug":"调用栈和任务队列","link":"#调用栈和任务队列","children":[]},{"level":2,"title":"事件循环机制","slug":"事件循环机制","link":"#事件循环机制","children":[]},{"level":2,"title":"宏任务和微任务","slug":"宏任务和微任务","link":"#宏任务和微任务","children":[]},{"level":2,"title":"node 事件循环","slug":"node-事件循环","link":"#node-事件循环","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"javascript/事件循环机制.md","lastUpdated":1677396047000}'),r={name:"javascript/事件循环机制.md"},F=l(`<h1 id="事件循环、微任务与宏任务" tabindex="-1">事件循环、微任务与宏任务 <a class="header-anchor" href="#事件循环、微任务与宏任务" aria-hidden="true">#</a></h1><p><strong>知识要点：</strong></p><ul><li>单线程的优缺点，以及为什么需要事件循环机制？</li><li>调用栈和任务队列是怎样的？</li><li>事件循环机制究竟是怎样的？</li><li>为什么需要微任务？微任务和宏任务分别是怎样的？</li><li>微任务和宏任务的执行顺序是怎样的？</li></ul><h2 id="单线程的优缺点" tabindex="-1">单线程的优缺点 <a class="header-anchor" href="#单线程的优缺点" aria-hidden="true">#</a></h2><p><code>javascript</code>是一门<strong>单线程非阻塞</strong>的语言。<strong>单线程</strong>的最大好处是不用像多线程编程那样处处在意状态的同步问题。试想一下，如果<code>js</code>是多线程语言，那么同时有两个或多个线程对一个<code>DOM</code>进行处理，<code>DOM</code>该如何展现呢？因此，为了避免这类问题的出现，<code>js</code>选择采用单线程来执行代码，这样就能保证程序的一致性了。</p><p>但是使用单线程又会带来新的麻烦：比如由于<code>js</code>和<code>UI</code>共用一个线程，<code>js</code>代码如果长时间执行，势必会导致<code>UI</code>一直无法渲染，这会严重地影响到用户的使用体验。</p><p>那么，有没有办法来解决这个问题呢？答案是有的，就是通过<strong>异步回调</strong>的方式来解决线程阻塞问题。而这就涉及到<code>js</code>中一个非常核心的知识点：事件循环机制（<code>Event Loop</code>）。</p><h2 id="调用栈和任务队列" tabindex="-1">调用栈和任务队列 <a class="header-anchor" href="#调用栈和任务队列" aria-hidden="true">#</a></h2><p>在讲事件循环之前，我们先熟悉一下<strong>调用栈</strong>和<strong>任务队列</strong>的概念。<strong>调用栈</strong>是一种数据结构，用于管理函数的调用关系。如果我们执行一个函数，那么会将这个函数压入到栈中；如果函数执行完毕了，那么会将这个函数从栈中弹出。比如：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">multiply</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">y</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">printSquare</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">multiply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">printSquare</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>刚开始的时候调用栈是空的，紧接着的执行步骤如下：</p><p><img src="`+o+'" alt="img"></p><p>当我们无限循环调用某个函数时，会一直向调用栈内添加调用的函数。当达到一定值的时候，就会超出栈的内存，这就是<strong>栈溢出</strong>。</p><p><img src="'+p+'" alt="img"></p><p>以上是同步执行代码的情况，如果遇到异步任务会发生什么呢？我们先看一张图：</p><p><img src="'+e+`" alt="img"></p><p><code>Call Stack</code>指的就是调用栈。</p><p><code>Web APIs</code>代表的<code>js</code>里的异步事件。</p><p><code>Callback Queue</code>则是由回调函数组成的<strong>任务队列</strong>，用于存放要执行的任务。</p><p>任务队列符合队列“先进先出”的特点，也就是说要添加任务的话，添加到队列的尾部；要取出任务的话，从队列头部去取。</p><p>但是调用栈、Web APIs和消息队列之间的关系到底是怎样的呢？这就需要我们了解一下事件循环机制了。</p><h2 id="事件循环机制" tabindex="-1">事件循环机制 <a class="header-anchor" href="#事件循环机制" aria-hidden="true">#</a></h2><p>在<code>MDN</code>上，事件循环描述是这样对的：之所以被称为事件循环，是因为它经常按照类似如下的方式实现：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 等待消息到来</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> (queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">waitForMessage</span><span style="color:#A6ACCD;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 处理消息</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">processNextMessage</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>这里结合上面提到的任务队列，可以理解为事件循环就是不断的从任务队列中取出任务，然后执行任务，等待新任务。让我们来看看下面这段代码具体发生了什么：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>首先，这整段代码可以看做一个任务，然后会被取出来执行，这里叫做任务A。当遇到<code>setTimeout</code>的时候（也就是调用了<code>Web APIs</code>）的时候，会进行异步执行。而当前任务A会不会等待<code>setTimeout</code>执行，而是继续执行下一段代码，当代码执行完毕时，任务A就算执行完毕了。此时又会从任务队列里取任务，发现没有任务，那么就开始等待。当过了一段时间，<code>setTimeout</code>执行完成后，会将回调函数添加到任务队列里。那么下次从任务队列里取任务时，发现有回调函数，就会取出这个回调函数，记做任务<code>B</code>，然后执行任务<code>B</code>。以此类推...</p><p>因此，事件循环就是一个取任务，执行任务，等待任务的循环过程。</p><h2 id="宏任务和微任务" tabindex="-1">宏任务和微任务 <a class="header-anchor" href="#宏任务和微任务" aria-hidden="true">#</a></h2><p>为什么要引入宏任务和微任务的概念呢？因为在我们的任务队列中，其实是无法区分优先级的，所有的任务都是按照被添加的时间顺序来排列，这显然不符合一些实时性要求较高的情况。因此，为了解决这个问题，引入了宏任务和微任务的概念，将任务划分了优先级。那么什么是宏任务什么是微任务呢？</p><p>这里具体的定义暂时是没有的，但是可以按照异步函数的类型进行大致划分：</p><p><strong>宏任务：包含执行整体的js代码，事件回调，XHR回调，定时器（setTimeout/setInterval/setImmediate），IO操作，UI render。</strong></p><p><strong>微任务：更新应用程序状态的任务，包括promise回调，MutationObserver，process.nextTick，Object.observe。</strong></p><p>接下来着重了解下微任务（<code>microTask</code>）和宏任务（<code>macroTask</code>）的执行顺序，这里有一张图：</p><p><img src="`+t+`" alt="img"></p><p>这里的<code>macroTask</code>组成的队列就是上面我们了解的任务队列。从这张图可以看出，<strong>每个宏任务之间都会有一个微任务队列</strong>。在执行完当前宏任务之后，在取得下一个宏任务之前，就会执行这个微任务队列里的每一个任务。下面我们结合具体例子进行说明：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><ol><li><p>首先，我们还是将这整段代码看作一个宏任务，叫做任务<code>A</code>，执行的时候打印<strong>start</strong>；</p></li><li><p>当执行到<code>setTimeout</code>的时候，任务<code>A</code>跳过<code>setTimeout</code>继续执行。而<code>setTimeout</code>会在时间到期后将回调函数添加到任务队列，这里将回调函数记为任务<code>B</code>；</p></li><li><p>当执行到<code>Promise</code>的时候，任务<code>A</code>跳过<code>Promise</code>继续执行。而将<code>then1</code>添加到任务<code>A</code>之后任务<code>B</code>之前的微任务队列中，记做微任务<code>C</code>。</p></li><li><p>任务<code>A</code>继续执行，打印<strong>end。</strong></p></li><li><p>当代码执行完毕，这个时候会去微任务队列中取任务，因此拿到了任务<code>C</code>并执行，打印<strong>promise1</strong>。执行的时候遇到了<code>then2</code>，因此将<code>then2</code>添加到当前微任务队列的末尾，记做任务<code>D</code>。任务<code>C执行完毕</code>。</p></li><li><p>继续从微任务队列中取任务，取到了任务<code>D</code>并执行，打印**promise2，**任务<code>D</code>执行完毕。</p></li><li><p>继续从微任务队列中取任务，发现没有任务。随后去任务队列中取下一个宏任务，得到任务<code>B</code>并执行，打印**setTimeout，**任务<code>B</code>执行完毕。</p></li><li><p>重复以上步骤取微任务和宏任务。</p></li></ol><p>因此，最终的打印结果是：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">start</span></span>
<span class="line"><span style="color:#A6ACCD;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">promise1</span></span>
<span class="line"><span style="color:#A6ACCD;">promise2</span></span>
<span class="line"><span style="color:#A6ACCD;">setTimeout</span></span>
<span class="line"></span></code></pre></div><p>通过<code>gif</code>图可以更直观的看下整个执行过程：</p><p><img src="`+c+`" alt="img"></p><p>至此，浏览器里的事件循环机制就学得差不多了。这里需要引起注意的一点是，<strong>每次取的是一个宏任务，而宏任务与宏任务之间是一个微任务队列，可能具有多个微任务。而且微任务里如果执行了微任务，同样会将新的微任务添加到当前微任务队列最后面，所以新添加的微任务是优先于下一个宏任务执行的。</strong></p><h2 id="node-事件循环" tabindex="-1">node 事件循环 <a class="header-anchor" href="#node-事件循环" aria-hidden="true">#</a></h2><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./file.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">9</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setImmediate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">8</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">6</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextTick</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextTick</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setImmediate</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">7</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>运行结果为<code>123456789</code>或<code>234567819</code>： 事件循环过程为：</p><ol><li>setTimeout队列 =&gt; IO callback队列 =&gt; setImmediate队列 =&gt; setTimeout队列 =&gt; ...</li><li>过程中穿插 nextTick 队列 =&gt; promise 队列</li></ol><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-hidden="true">#</a></h2><ul><li><a href="http://lynnelv.github.io/js-event-loop-browser" target="_blank" rel="noreferrer">深入理解js事件循环机制（浏览器篇）</a></li><li><a href="http://lynnelv.github.io/js-event-loop-nodejs" target="_blank" rel="noreferrer">深入理解js事件循环机制（Node.js篇）</a></li><li><a href="https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/" target="_blank" rel="noreferrer">Node.js官方文档</a></li><li><a href="https://weread.qq.com/web/reader/d1b32290718ff65fd1befcck02e32f0021b02e74f10ece8" target="_blank" rel="noreferrer">《深入浅出Node.js》</a></li><li><a href="https://zhuanlan.zhihu.com/p/33058983" target="_blank" rel="noreferrer">详解JavaScript中的Event Loop（事件循环）机制</a></li><li><a href="https://time.geekbang.org/column/article/132931" target="_blank" rel="noreferrer">浏览器工作原理与实践</a></li><li><a href="https://time.geekbang.org/column/article/227926" target="_blank" rel="noreferrer">图解Google V8</a></li><li><a href="https://blog.sessionstack.com/how-does-javascript-actually-work-part-1-b0bacc073cf" target="_blank" rel="noreferrer">how does javascript actually work</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop" target="_blank" rel="noreferrer">MDN Event Loop</a></li></ul>`,49),y=[F];function i(D,A,C,d,g,h){return a(),n("div",null,y)}const f=s(r,[["render",i]]);export{u as __pageData,f as default};
