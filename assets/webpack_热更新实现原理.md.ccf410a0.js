import{_ as n,c as s,o as a,a as t}from"./app.28de33c1.js";var p="/assets/hot-replacement-runtime.2b6259be.jpg";const f='{"title":"\u70ED\u66F4\u65B0\u5B9E\u73B0\u539F\u7406","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u542F\u52A8","slug":"\u542F\u52A8"},{"level":2,"title":"webpack-dev-server","slug":"webpack-dev-server"},{"level":2,"title":"\u6DFB\u52A0client\u7AEFsocket\u4EE3\u7801","slug":"\u6DFB\u52A0client\u7AEFsocket\u4EE3\u7801"},{"level":3,"title":"client/index.js","slug":"client-index-js"},{"level":3,"title":"webpack/hot/dev-server.js","slug":"webpack-hot-dev-server-js"},{"level":3,"title":"\u5C0F\u7ED3","slug":"\u5C0F\u7ED3"},{"level":2,"title":"\u63D0\u4F9B_webpackdevserverclient__","slug":"\u63D0\u4F9B-webpack-dev-server-client"},{"level":2,"title":"HotModuleReplacementPlugin","slug":"hotmodulereplacementplugin"},{"level":3,"title":"1. \u5904\u7406\u70ED\u66F4\u65B0api","slug":"_1-\u5904\u7406\u70ED\u66F4\u65B0api"},{"level":3,"title":"2. hooks.additionalTreeRuntimeRequirements","slug":"_2-hooks-additionaltreeruntimerequirements"},{"level":3,"title":"3. hooks.fullhash","slug":"_3-hooks-fullhash"},{"level":3,"title":"4. hooks.processAssets","slug":"_4-hooks-processassets"},{"level":3,"title":"5. hooks.record","slug":"_5-hooks-record"},{"level":3,"title":"\u5C0F\u7ED3","slug":"\u5C0F\u7ED3-1"},{"level":2,"title":"\u5EFA\u7ACB\u670D\u52A1\u7AEFserver","slug":"\u5EFA\u7ACB\u670D\u52A1\u7AEFserver"},{"level":2,"title":"webpack-dev-middleware","slug":"webpack-dev-middleware"},{"level":2,"title":"hotCheck","slug":"hotcheck"},{"level":3,"title":"[fullhash].hot-update.json","slug":"fullhash-hot-update-json"},{"level":3,"title":"[fullhash].hot-update.js","slug":"fullhash-hot-update-js"},{"level":2,"title":"hotApply","slug":"hotapply"},{"level":3,"title":"module.hot\u76F8\u5173api\u5B9A\u4E49","slug":"module-hot\u76F8\u5173api\u5B9A\u4E49"},{"level":3,"title":"applyInvalidatedModules","slug":"applyinvalidatedmodules"},{"level":3,"title":"applyHandler","slug":"applyhandler"},{"level":3,"title":"dispose","slug":"dispose"},{"level":3,"title":"apply","slug":"apply"},{"level":2,"title":"hash \u66F4\u65B0","slug":"hash-\u66F4\u65B0"},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3"}],"relativePath":"webpack/\u70ED\u66F4\u65B0\u5B9E\u73B0\u539F\u7406.md","lastUpdated":1658793576000}',o={},e=t(`<h1 id="\u70ED\u66F4\u65B0\u5B9E\u73B0\u539F\u7406" tabindex="-1">\u70ED\u66F4\u65B0\u5B9E\u73B0\u539F\u7406 <a class="header-anchor" href="#\u70ED\u66F4\u65B0\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a></h1><p><a href="https://webpack.docschina.org/configuration/dev-server/#root" target="_blank" rel="noopener noreferrer">webpack DevServer \u914D\u7F6E</a></p><h2 id="\u542F\u52A8" tabindex="-1">\u542F\u52A8 <a class="header-anchor" href="#\u542F\u52A8" aria-hidden="true">#</a></h2><p>\u5F53\u8FD0\u884C<code>webpack serve</code>\u547D\u4EE4\u65F6\uFF0C\u89E3\u6790\u547D\u4EE4\u540E\u4F1A\u52A0\u8F7D<code>node_modules/@webpack-cli/serve/lib/index.js</code>\u4E2D\u7684<code>ServeCommand</code>\uFF0C\u5E76\u6267\u884C\u5176<code>apply</code>\u65B9\u6CD5\uFF0C\u6700\u540E\u89E6\u53D1\u56DE\u8C03\u51FD\u6570\uFF0C\u7CBE\u7B80\u540E\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// 1. \u521B\u5EFA compiler</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">await</span> cli<span class="token punctuation">.</span><span class="token function">createCompiler</span><span class="token punctuation">(</span>webpackCLIOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. \u52A0\u8F7D webpack-dev-server \u5305</span>
<span class="token keyword">const</span> DevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token constant">WEBPACK_DEV_SERVER_PACKAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. \u6574\u7406\u6240\u6709 compilers</span>
<span class="token keyword">const</span> compilers <span class="token operator">=</span> <span class="token keyword">typeof</span> compiler<span class="token punctuation">.</span>compilers <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">?</span> compiler<span class="token punctuation">.</span>compilers <span class="token operator">:</span> <span class="token punctuation">[</span>compiler<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> possibleCompilers <span class="token operator">=</span> compilers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>devServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compilersForDevServer <span class="token operator">=</span> possibleCompilers<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> possibleCompilers <span class="token operator">:</span> <span class="token punctuation">[</span>compilers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 4. \u904D\u5386\u6240\u6709 compilers</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> compilerForDevServer <span class="token keyword">of</span> compilersForDevServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 5. \u63D0\u53D6 devServer \u914D\u7F6E</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>compilerForDevServer<span class="token punctuation">.</span>options<span class="token punctuation">.</span>devServer <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  devServerOptions <span class="token operator">=</span> result<span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> server<span class="token punctuation">;</span>
    <span class="token comment">// 6. \u8FD0\u884C devServer</span>
    server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DevServer</span><span class="token punctuation">(</span>devServerOptions<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> server<span class="token punctuation">.</span>start <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    servers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="webpack-dev-server" tabindex="-1">webpack-dev-server <a class="header-anchor" href="#webpack-dev-server" aria-hidden="true">#</a></h2><p>\u627E\u5230<code>node_modules/webpack-dev-server/lib/Server.js</code>\u6587\u4EF6\u4E2D\u7684<code>start</code>\u51FD\u6570\uFF0C\u7CBE\u7B80\u540E\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">async</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. \u6574\u7406 options</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">normalizeOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2. \u521D\u59CB\u5316</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3. \u76D1\u542C\u8BF7\u6C42</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>listenOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 4. \u521B\u5EFA websocket server</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>webSocketServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createWebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u5176\u4E2D\u6700\u6838\u5FC3\u7684\u662F\u521D\u59CB\u5316\u8FC7\u7A0B\uFF0C\u4E0B\u9762\u7740\u91CD\u8BB2\u89E3<code>initialize</code>\u65B9\u6CD5\u3002</p><h2 id="\u6DFB\u52A0client\u7AEFsocket\u4EE3\u7801" tabindex="-1">\u6DFB\u52A0client\u7AEFsocket\u4EE3\u7801 <a class="header-anchor" href="#\u6DFB\u52A0client\u7AEFsocket\u4EE3\u7801" aria-hidden="true">#</a></h2><p><code>initialize</code>\u65B9\u6CD5\u9996\u5148\u6267\u884C<code>addAdditionalEntries</code>\u65B9\u6CD5\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// \u6DFB\u52A0 client socket \u4EE3\u7801</span>
additionalEntries<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;../client/index.js&quot;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>webSocketURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u6DFB\u52A0 webpack dev-server \u4EE3\u7801</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>hot <span class="token operator">===</span> <span class="token string">&quot;only&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hotEntry <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;webpack/hot/only-dev-server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hotEntry <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;webpack/hot/dev-server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
additionalEntries<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hotEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5E94\u7528 entry</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> webpack<span class="token punctuation">.</span>EntryPlugin <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> additionalEntry <span class="token keyword">of</span> additionalEntries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>EntryPlugin</span><span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>context<span class="token punctuation">,</span> additionalEntry<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u8BE5\u51FD\u6570\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u6DFB\u52A0\u4E86\u4E24\u4E2A<code>entry</code>\uFF0C\u76F8\u5F53\u4E8E\u6700\u7EC8\u6253\u5305\u51FA\u6765\u7684<code>bundle</code>\u6587\u4EF6\u4F1A\u5F15\u5165\u8FD9\u4E24\u4E2A<code>entry</code>\u5BF9\u5E94\u7684\u4EE3\u7801\u3002</p><h3 id="client-index-js" tabindex="-1">client/index.js <a class="header-anchor" href="#client-index-js" aria-hidden="true">#</a></h3><p>\u9996\u5148\u662F<code>../client/index.js</code>\u6587\u4EF6\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// client/index.js \u6587\u4EF6</span>
<span class="token comment">// \u521B\u5EFA\u4E86 WebSocket \u5BA2\u6237\u7AEF</span>
<span class="token keyword">var</span> socketURL <span class="token operator">=</span> <span class="token function">createSocketURL</span><span class="token punctuation">(</span>parsedResourceQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">socket</span><span class="token punctuation">(</span>socketURL<span class="token punctuation">,</span> onSocketMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// client/socket.js \u6587\u4EF6</span>
<span class="token keyword">var</span> Client <span class="token operator">=</span> 
    <span class="token keyword">typeof</span> __webpack_dev_server_client__ <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">?</span>
    <span class="token keyword">typeof</span> __webpack_dev_server_client__<span class="token punctuation">.</span>default <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">?</span> __webpack_dev_server_client__<span class="token punctuation">.</span>default <span class="token operator">:</span> __webpack_dev_server_client__ <span class="token operator">:</span> WebSocketClient<span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">socket</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">initSocket</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> handlers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> socket<span class="token punctuation">;</span>
</code></pre></div><p>\u8BE5\u6587\u4EF6\u7684\u6838\u5FC3\u662F\u521B\u5EFA\u4E86\u4E00\u4E2A<code>WebSocket</code>\u7684\u5BA2\u6237\u7AEF\uFF0C\u7528\u4E8E\u63A5\u6536\u670D\u52A1\u7AEF\u4F20\u9012\u7684\u4FE1\u606F\u3002</p><h3 id="webpack-hot-dev-server-js" tabindex="-1">webpack/hot/dev-server.js <a class="header-anchor" href="#webpack-hot-dev-server-js" aria-hidden="true">#</a></h3><p>\u5176\u6B21\u662F<code>dev-server.js</code>\u6587\u4EF6\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>hot
      <span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">updatedModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./emitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hotEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;webpackHotUpdate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">currentHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lastHash <span class="token operator">=</span> currentHash<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">upToDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;idle&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;[HMR] Checking for updates on the server...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u8BE5\u4EE3\u7801\u7684\u6838\u5FC3\u903B\u8F91\u662F\u76D1\u542C<code>webpackHotUpdate</code>\u4E8B\u4EF6\uFF0C\u89E6\u53D1<code>check</code>\u65B9\u6CD5\u7684\u6267\u884C\u3002</p><h3 id="\u5C0F\u7ED3" tabindex="-1">\u5C0F\u7ED3 <a class="header-anchor" href="#\u5C0F\u7ED3" aria-hidden="true">#</a></h3><p><code>addAdditionalEntries</code>\u901A\u8FC7\u6DFB\u52A0\u4E24\u4E2A<code>entry</code>\uFF0C\u5728<code>bundle</code>\u91CC\u6DFB\u52A0\u4E86<code>WebSocket</code>\u5BA2\u6237\u7AEF\u4EE3\u7801\uFF0C\u4F7F\u5F97\u5BA2\u6237\u7AEF\u5177\u5907\u63A5\u6536\u670D\u52A1\u7AEF\u6D88\u606F\u7684\u80FD\u529B\u3002</p><h2 id="\u63D0\u4F9B-webpack-dev-server-client" tabindex="-1">\u63D0\u4F9B__webpack_dev_server_client__ <a class="header-anchor" href="#\u63D0\u4F9B-webpack-dev-server-client" aria-hidden="true">#</a></h2><p>\u6DFB\u52A0\u5B8C<code>entry</code>\u540E\uFF0C\u63A5\u7740\u8C03\u7528<code>ProvidePlugin</code>\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">__webpack_dev_server_client__</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClientTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u8BE5\u63D2\u4EF6\u76F8\u5F53\u4E8E\u4E3A\u5168\u5C40\u63D0\u4F9B\u4E86\u53D8\u91CF\u3002\u8FD9\u5C31\u610F\u5473\u7740<code>bundle.js</code>\u6587\u4EF6\u91CC\u7684\u4EE3\u7801\u53EF\u4EE5\u8BBF\u95EE<code>__webpack_dev_server_client__</code>\u53D8\u91CF\uFF0C\u800C<code>this.getClientTransport()</code>\u65B9\u6CD5\u5219\u662F\u63D0\u4F9B\u5BA2\u6237\u7AEF\u7684<code>socket</code>\u4EE3\u7801\uFF0C\u8FD9\u91CC\u9ED8\u8BA4\u4F7F\u7528\u7684\u662F<code>WebSocket</code>\u3002\u6211\u4EEC\u5728\u4E0A\u9762<code>entry</code>\u4E2D\u7684<code>client/index.js</code>\u6587\u4EF6\u4E2D\u4F7F\u7528\u5230\u4E86\u8FD9\u4E2A\u53D8\u91CF\u3002</p><h2 id="hotmodulereplacementplugin" tabindex="-1">HotModuleReplacementPlugin <a class="header-anchor" href="#hotmodulereplacementplugin" aria-hidden="true">#</a></h2><p>\u5176\u6B21\u662F\u5E94\u7528<code>HotModuleReplacementPlugin</code>\u63D2\u4EF6\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">const</span> plugin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u8BE5\u63D2\u4EF6\u5B9A\u4E49\u5728<code>webpack/lib/HotModuleReplacementPlugin.js</code>\u6587\u4EF6\u4E2D\u3002\u4E0B\u9762\u6211\u4EEC\u5206\u6790\u4E00\u4E0B\u5176\u4F5C\u7528\u3002</p><h3 id="_1-\u5904\u7406\u70ED\u66F4\u65B0api" tabindex="-1">1. \u5904\u7406\u70ED\u66F4\u65B0api <a class="header-anchor" href="#_1-\u5904\u7406\u70ED\u66F4\u65B0api" aria-hidden="true">#</a></h3><p>\u9996\u5148\u4F1A\u5B9A\u4E49<code>module.hot</code>\u76F8\u5173<code>api</code>\u7684<code>dependency</code>\u4EE5\u53CA<code>template</code>\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">//#region module.hot.* API</span>
compilation<span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  ModuleHotAcceptDependency<span class="token punctuation">,</span>
  normalModuleFactory
<span class="token punctuation">)</span><span class="token punctuation">;</span>
compilation<span class="token punctuation">.</span>dependencyTemplates<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  ModuleHotAcceptDependency<span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">ModuleHotAcceptDependency<span class="token punctuation">.</span>Template</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
compilation<span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  ModuleHotDeclineDependency<span class="token punctuation">,</span>
  normalModuleFactory
<span class="token punctuation">)</span><span class="token punctuation">;</span>
compilation<span class="token punctuation">.</span>dependencyTemplates<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  ModuleHotDeclineDependency<span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">ModuleHotDeclineDependency<span class="token punctuation">.</span>Template</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u7136\u540E\u76D1\u542C<code>parser</code>\u9636\u6BB5\uFF0C\u5BF9<code>module.hot</code>\u7B49<code>api</code>\u8FDB\u884C\u89E3\u6790\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-javascript"><pre><code>parser<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>call
  <span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;module.hot.accept&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
  <span class="token string">&quot;HotModuleReplacementPlugin&quot;</span><span class="token punctuation">,</span>
  <span class="token function">createAcceptHandler</span><span class="token punctuation">(</span>parser<span class="token punctuation">,</span> ModuleHotAcceptDependency<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u56E0\u6B64<code>module.hot</code>\u7B49<code>api</code>\u7ECF\u8FC7<code>parser</code>\u540E\u4F1A\u53D8\u4E3A\u76F8\u5E94\u7684<code>dependency</code>\u3002\u5728<code>code generate</code>\u65F6\uFF0C\u8C03\u7528\u5BF9\u5E94\u7684<code>template</code>\u751F\u6210\u65B0\u7684\u4EE3\u7801\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// \u8F6C\u6362\u524D</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./moduleB.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;======&gt;  accept B&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u8F6C\u6362\u540E</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token comment">/*! ./moduleB.js */</span> <span class="token string">&quot;./src/moduleB.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token parameter">__WEBPACK_OUTDATED_DEPENDENCIES__</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
    <span class="token comment">/* harmony import */</span> _moduleB__WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./moduleB.js */</span> <span class="token string">&quot;./src/moduleB.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;======&gt;  accept B&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>__WEBPACK_OUTDATED_DEPENDENCIES__<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-hooks-additionaltreeruntimerequirements" tabindex="-1">2. hooks.additionalTreeRuntimeRequirements <a class="header-anchor" href="#_2-hooks-additionaltreeruntimerequirements" aria-hidden="true">#</a></h3><p>\u5728<code>seal</code>\u9636\u6BB5\uFF0C\u6240\u6709\u6A21\u5757\u7684\u4EE3\u7801\u751F\u6210\u4E4B\u540E\uFF0C\u4F1A\u8C03\u7528<code>additionalTreeRuntimeRequirements</code>\u94A9\u5B50\uFF0C\u7528\u4E8E\u6DFB\u52A0\u6A21\u5757\u5728\u4EE3\u7801\u751F\u6210\u65F6\u9700\u8981\u7684<code>runtime</code>\u4EE3\u7801\u3002\u5982\u679C\u4F7F\u7528\u5230\u4E86\u70ED\u66F4\u65B0\u529F\u80FD\uFF0C\u90A3\u4E48\u4F1A\u6DFB\u52A0\u70ED\u66F4\u65B0\u76F8\u5173\u7684<code>runtime</code>\u4EE3\u7801\uFF1A</p><div class="language-javascript"><pre><code>compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>additionalTreeRuntimeRequirements<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
  <span class="token string">&quot;HotModuleReplacementPlugin&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> runtimeRequirements</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    runtimeRequirements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>RuntimeGlobals<span class="token punctuation">.</span>hmrDownloadManifest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    runtimeRequirements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>RuntimeGlobals<span class="token punctuation">.</span>hmrDownloadUpdateHandlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    runtimeRequirements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>RuntimeGlobals<span class="token punctuation">.</span>interceptModuleExecution<span class="token punctuation">)</span><span class="token punctuation">;</span>
    runtimeRequirements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>RuntimeGlobals<span class="token punctuation">.</span>moduleCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
    compilation<span class="token punctuation">.</span><span class="token function">addRuntimeModule</span><span class="token punctuation">(</span>
      chunk<span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HotModuleReplacementRuntimeModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u6CE8\u610F\u8FD9\u4E2A\u65F6\u5019\u6DFB\u52A0\u4E86\u4E00\u4E2A\u65B0\u7684module\u4E3AHotModuleReplacementRuntimeModule\u3002\u5728<code>webpack/lib/hmr/HotModuleReplacementRuntimeModule.js</code>\u4E2D\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">class</span> <span class="token class-name">HotModuleReplacementRuntimeModule</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeModule</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;hot module replacement&quot;</span><span class="token punctuation">,</span> RuntimeModule<span class="token punctuation">.</span><span class="token constant">STAGE_BASIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> Template<span class="token punctuation">.</span><span class="token function">getFunctionContent</span><span class="token punctuation">(</span>
			<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./HotModuleReplacement.runtime.js&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$getFullHash\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> RuntimeGlobals<span class="token punctuation">.</span>getFullHash<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
				<span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$interceptModuleExecution\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
				RuntimeGlobals<span class="token punctuation">.</span>interceptModuleExecution
			<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$moduleCache\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> RuntimeGlobals<span class="token punctuation">.</span>moduleCache<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$hmrModuleData\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> RuntimeGlobals<span class="token punctuation">.</span>hmrModuleData<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$hmrDownloadManifest\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> RuntimeGlobals<span class="token punctuation">.</span>hmrDownloadManifest<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
				<span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$hmrInvalidateModuleHandlers\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
				RuntimeGlobals<span class="token punctuation">.</span>hmrInvalidateModuleHandlers
			<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
				<span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\$hmrDownloadUpdateHandlers\\$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>
				RuntimeGlobals<span class="token punctuation">.</span>hmrDownloadUpdateHandlers
			<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>\u5728\u751F\u6210\u4EE3\u7801\u9636\u6BB5\u4F1A\u8C03\u7528module.generate\u65B9\u6CD5\uFF0C\u6240\u4EE5HotModuleReplacementRuntimeModule\u6A21\u5757\u6700\u7EC8\u751F\u6210\u7684\u4EE3\u7801\u76F8\u5F53\u4E8Erequire(&quot;./HotModuleReplacement.runtime.js&quot;)\u6587\u4EF6\u4E2D\u7684\u4EE3\u7801\uFF0C\u7136\u540E\u7528\u6B63\u5219\u5C06$\u5F00\u5934\u7684\u4E00\u4E9B\u53D8\u91CF\u66FF\u6362\u540E\u7684\u4EE3\u7801\u3002\u800C\u8FD9\u4E2A\u6587\u4EF6\u7684\u4EE3\u7801\uFF0C\u6B63\u662F\u70ED\u66F4\u65B0\u4E2D\u66F4\u65B0\u8FC7\u7A0B\u7684\u6838\u5FC3\u4EE3\u7801\u3002</strong></p><h3 id="_3-hooks-fullhash" tabindex="-1">3. hooks.fullhash <a class="header-anchor" href="#_3-hooks-fullhash" aria-hidden="true">#</a></h3><p>\u5F85<code>runtime</code>\u4EE3\u7801\u4E5F\u88AB\u6DFB\u52A0\u4E4B\u540E\uFF0C\u4E3A\u9879\u76EE\u751F\u6210\u65B0\u7684<code>fullhash</code>\uFF0C\u6B64\u65F6\u4F1A\u8C03\u7528<code>hooks.fullhash</code>\u94A9\u5B50\uFF0C\u89E6\u53D1<code>HotModuleReplacementPlugin</code>\u63D2\u4EF6\uFF1A</p><div class="language-javascript"><pre><code>compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>fullHash<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;HotModuleReplacementPlugin&quot;</span><span class="token punctuation">,</span> <span class="token parameter">hash</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> compilation<span class="token punctuation">.</span>chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> modules <span class="token operator">=</span> chunkGraph<span class="token punctuation">.</span><span class="token function">getChunkModulesIterable</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fullHashModulesInThisChunk<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>records<span class="token punctuation">.</span>fullHashChunkModuleHashes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          updatedModules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fullHashChunkModuleHashes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> hash<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>records<span class="token punctuation">.</span>chunkModuleHashes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          updatedModules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        chunkModuleHashes<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> hash<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>\u8FD9\u6BB5\u4EE3\u7801\u6709\u5F88\u591A\u5206\u652F\uFF0C\u8FD9\u91CC\u505A\u4E86\u7CBE\u7B80\u5904\u7406\u3002\u5176\u6838\u5FC3\u4F5C\u7528\u662F\u5BF9\u6BD4<code>chunk</code>\u4E2D\u7684<code>module</code>\u7684<code>hash</code>\u503C\u3002\u5982\u679C\u4E0E\u539F\u6765\u5B58\u653E\u7684<code>hash</code>\u4E0D\u76F8\u7B49\uFF0C\u90A3\u4E48\u5C06<code>module/chunk</code>\u6DFB\u52A0\u5230<code>updatedModules</code>\u4E2D\u3002\u56E0\u6B64\uFF0C\u53EF\u4EE5\u5224\u522B\u51FA\u54EA\u4E9B<code>module</code>\u4EA7\u751F\u4E86\u66F4\u65B0\u3002</p><h3 id="_4-hooks-processassets" tabindex="-1">4. hooks.processAssets <a class="header-anchor" href="#_4-hooks-processassets" aria-hidden="true">#</a></h3><p>\u5728\u6240\u6709\u4EE3\u7801\u751F\u6210\u5B8C\u6210\u4E4B\u540E\uFF0C\u8C03\u7528<code>hooks.processAssets</code>\u94A9\u5B50\uFF0C\u89E6\u53D1<code>HotModuleReplacementPlugin</code>\u63D2\u4EF6\uFF1A</p><div class="language-javascript"><pre><code>compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>processAssets<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;HotModuleReplacementPlugin&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">stage</span><span class="token operator">:</span> Compilation<span class="token punctuation">.</span><span class="token constant">PROCESS_ASSETS_STAGE_ADDITIONAL</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span>chunkHashes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// \u65B0 module</span>
      newModules <span class="token operator">=</span> chunkGraph
        <span class="token punctuation">.</span><span class="token function">getChunkModules</span><span class="token punctuation">(</span>currentChunk<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> updatedModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> currentChunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// \u65B0 runtime module</span>
      newRuntimeModules <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>
        chunkGraph<span class="token punctuation">.</span><span class="token function">getChunkRuntimeModulesIterable</span><span class="token punctuation">(</span>currentChunk<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> updatedModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> currentChunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// \u65B0 fullhash module</span>
      <span class="token keyword">const</span> fullHashModules <span class="token operator">=</span>
            chunkGraph<span class="token punctuation">.</span><span class="token function">getChunkFullHashModulesIterable</span><span class="token punctuation">(</span>currentChunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
      newFullHashModules <span class="token operator">=</span>
        fullHashModules <span class="token operator">&amp;&amp;</span>
        Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>fullHashModules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span>
                                           updatedModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> currentChunk<span class="token punctuation">)</span>
                                          <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> dependentHashModules <span class="token operator">=</span>
            chunkGraph<span class="token punctuation">.</span><span class="token function">getChunkDependentHashModulesIterable</span><span class="token punctuation">(</span>currentChunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// \u65B0 dependency module</span>
      newDependentHashModules <span class="token operator">=</span>
        dependentHashModules <span class="token operator">&amp;&amp;</span>
        Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>dependentHashModules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span>
                                                updatedModules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> currentChunk<span class="token punctuation">)</span>
                                               <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// \u79FB\u9664\u7684 runtime module</span>
      removedFromRuntime <span class="token operator">=</span> <span class="token function">subtractRuntime</span><span class="token punctuation">(</span>oldRuntime<span class="token punctuation">,</span> newRuntime<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>\u9996\u5148\u4F1A\u5BF9<code>chunk</code>\u4E0B\u7684<code>module</code>\u7684<code>hash</code>\u503C\u8FDB\u884C\u5BF9\u6BD4\u3002\u5BF9\u6BD4\u5B8C\u6210\u540E\uFF0C\u5F97\u5230\u4E86\u66F4\u65B0\u7684<code>module</code>\u3002\u968F\u540E\u4E3A\u8FD9\u4E9B\u66F4\u65B0\u540E\u7684<code>module</code>\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684<code>chunk</code>\uFF0C\u7C7B\u578B\u4E3A<code>HotUpdateChunk</code>\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// 1. \u521B\u5EFA HotUpdateChunk</span>
<span class="token keyword">const</span> hotUpdateChunk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HotUpdateChunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. \u8BB0\u5F55 chunk</span>
ChunkGraph<span class="token punctuation">.</span><span class="token function">setChunkGraphForChunk</span><span class="token punctuation">(</span>hotUpdateChunk<span class="token punctuation">,</span> chunkGraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
hotUpdateChunk<span class="token punctuation">.</span>id <span class="token operator">=</span> chunkId<span class="token punctuation">;</span>
hotUpdateChunk<span class="token punctuation">.</span>runtime <span class="token operator">=</span> newRuntime<span class="token punctuation">;</span>
<span class="token comment">// 3. \u6DFB\u52A0\u5230\u5F53\u524D chunkGroup</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>currentChunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> group <span class="token keyword">of</span> currentChunk<span class="token punctuation">.</span>groupsIterable<span class="token punctuation">)</span>
    hotUpdateChunk<span class="token punctuation">.</span><span class="token function">addGroup</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 4. \u5EFA\u7ACB\u8054\u7CFB</span>
chunkGraph<span class="token punctuation">.</span><span class="token function">attachModules</span><span class="token punctuation">(</span>hotUpdateChunk<span class="token punctuation">,</span> newModules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chunkGraph<span class="token punctuation">.</span><span class="token function">attachRuntimeModules</span><span class="token punctuation">(</span>
  hotUpdateChunk<span class="token punctuation">,</span>
  newRuntimeModules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>newFullHashModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chunkGraph<span class="token punctuation">.</span><span class="token function">attachFullHashModules</span><span class="token punctuation">(</span>
    hotUpdateChunk<span class="token punctuation">,</span>
    newFullHashModules
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>newDependentHashModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chunkGraph<span class="token punctuation">.</span><span class="token function">attachDependentHashModules</span><span class="token punctuation">(</span>
    hotUpdateChunk<span class="token punctuation">,</span>
    newDependentHashModules
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 5. \u65B0\u589E chunk render</span>
<span class="token keyword">const</span> renderManifest <span class="token operator">=</span> compilation<span class="token punctuation">.</span><span class="token function">getRenderManifest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">chunk</span><span class="token operator">:</span> hotUpdateChunk<span class="token punctuation">,</span>
  <span class="token literal-property property">hash</span><span class="token operator">:</span> records<span class="token punctuation">.</span>hash<span class="token punctuation">,</span>
  <span class="token literal-property property">fullHash</span><span class="token operator">:</span> records<span class="token punctuation">.</span>hash<span class="token punctuation">,</span>
  <span class="token literal-property property">outputOptions</span><span class="token operator">:</span> compilation<span class="token punctuation">.</span>outputOptions<span class="token punctuation">,</span>
  <span class="token literal-property property">moduleTemplates</span><span class="token operator">:</span> compilation<span class="token punctuation">.</span>moduleTemplates<span class="token punctuation">,</span>
  <span class="token literal-property property">dependencyTemplates</span><span class="token operator">:</span> compilation<span class="token punctuation">.</span>dependencyTemplates<span class="token punctuation">,</span>
  <span class="token literal-property property">codeGenerationResults</span><span class="token operator">:</span> compilation<span class="token punctuation">.</span>codeGenerationResults<span class="token punctuation">,</span>
  <span class="token literal-property property">runtimeTemplate</span><span class="token operator">:</span> compilation<span class="token punctuation">.</span>runtimeTemplate<span class="token punctuation">,</span>
  <span class="token literal-property property">moduleGraph</span><span class="token operator">:</span> compilation<span class="token punctuation">.</span>moduleGraph<span class="token punctuation">,</span>
  chunkGraph
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 6. \u751F\u6210\u4EE3\u7801\uFF0C\u5E76\u8FDB\u884C emit</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> renderManifest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> filename<span class="token punctuation">;</span>
  <span class="token keyword">let</span> assetInfo<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;filename&quot;</span> <span class="token keyword">in</span> entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    filename <span class="token operator">=</span> entry<span class="token punctuation">.</span>filename<span class="token punctuation">;</span>
    assetInfo <span class="token operator">=</span> entry<span class="token punctuation">.</span>info<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> filename<span class="token punctuation">,</span> <span class="token literal-property property">info</span><span class="token operator">:</span> assetInfo <span class="token punctuation">}</span> <span class="token operator">=</span>
     compilation<span class="token punctuation">.</span><span class="token function">getPathWithInfo</span><span class="token punctuation">(</span>
      entry<span class="token punctuation">.</span>filenameTemplate<span class="token punctuation">,</span>
      entry<span class="token punctuation">.</span>pathOptions
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compilation<span class="token punctuation">.</span>additionalChunkAssets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">hotModuleReplacement</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>assetInfo
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentChunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentChunk<span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">chunkAsset</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>currentChunk<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 8. \u8BB0\u5F55\u66F4\u65B0\u7684 runtime</span>
<span class="token function">forEachRuntime</span><span class="token punctuation">(</span>newRuntime<span class="token punctuation">,</span> <span class="token parameter">runtime</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  hotUpdateMainContentByRuntime
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>runtime<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>updatedChunkIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u5177\u4F53\u7684\u6267\u884C\u6B65\u9AA4\u5DF2\u7ECF\u6CE8\u91CA\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F<code>HotUpdateChunk</code>\u5728<code>getRenderManifest</code>\u65F6\uFF0C\u6B64\u65F6<code>filename</code>\u83B7\u53D6\u7684\u662F<code>outputOptions.hotUpdateChunkFilename</code>\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// \u8C03\u7528getRenderManifest\u65F6\u89E6\u53D1</span>
<span class="token keyword">const</span> filenameTemplate <span class="token operator">=</span> JavascriptModulesPlugin<span class="token punctuation">.</span><span class="token function">getChunkFilenameTemplate</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> outputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  render<span class="token punctuation">,</span>
  filenameTemplate<span class="token punctuation">,</span>
  <span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//  \u5B9E\u9645\u4F7F\u7528\u7684\u662F getChunkFilenameTemplate \u65B9\u6CD5\u83B7\u53D6 filename</span>
<span class="token keyword">static</span> <span class="token function">getChunkFilenameTemplate</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> outputOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>filenameTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> chunk<span class="token punctuation">.</span>filenameTemplate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk <span class="token keyword">instanceof</span> <span class="token class-name">HotUpdateChunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> outputOptions<span class="token punctuation">.</span>hotUpdateChunkFilename<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">canBeInitial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> outputOptions<span class="token punctuation">.</span>filename<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> outputOptions<span class="token punctuation">.</span>chunkFilename<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u800C\u5728\u9879\u76EE\u542F\u52A8\u7684\u521D\u59CB\u5316\u9636\u6BB5\uFF0C\u5B9A\u4E49\u4E86\u4E00\u4E9B\u5C5E\u6027\uFF0C\u5176\u4E2D\u5C31\u5305\u542B<code>hotUpdateChunkFilename</code>\uFF1A</p><div class="language-javascript"><pre><code><span class="token constant">D</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">&quot;hotUpdateChunkFilename&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[id].[fullhash].hot-update.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>output<span class="token punctuation">.</span>module <span class="token operator">?</span> <span class="token string">&quot;mjs&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;js&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">D</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">&quot;hotUpdateMainFilename&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;[runtime].[fullhash].hot-update.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u8FD9\u5C31\u662F\u70ED\u66F4\u65B0\u65F6<code>xxx.hot-update.js</code>\u6587\u4EF6\u751F\u6210\u7684\u5B9E\u9645\u4F4D\u7F6E\uFF0C\u5B83\u5305\u542B\u4E86\u6240\u6709\u66F4\u65B0\u7684\u6A21\u5757\u7684\u4EE3\u7801\u3002</p><p>\u6700\u540E\uFF0C\u6839\u636E\u66F4\u65B0\u7684\u6A21\u5757\uFF0C\u5C06\u53D8\u52A8\u4FE1\u606F\u76F4\u63A5\u8F93\u51FA\u5230<code>xxx.hot-update.json</code>\u6587\u4EF6\u5F53\u4E2D\u3002</p><div class="language-javascript"><pre><code><span class="token comment">// \u6DFB\u52A0 xxx-hot-update.json</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>
  filename<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> removedChunkIds<span class="token punctuation">,</span> removedModules<span class="token punctuation">,</span> updatedChunkIds<span class="token punctuation">,</span> assetInfo <span class="token punctuation">}</span>
<span class="token punctuation">]</span> <span class="token keyword">of</span> hotUpdateMainContentByFilename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hotUpdateMainJson <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">c</span><span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>updatedChunkIds<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">r</span><span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>removedChunkIds<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">m</span><span class="token operator">:</span>
    removedModules<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token number">0</span>
    <span class="token operator">?</span> completelyRemovedModulesArray
    <span class="token operator">:</span> completelyRemovedModulesArray<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
      Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>removedModules<span class="token punctuation">,</span> <span class="token parameter">m</span> <span class="token operator">=&gt;</span>
                 chunkGraph<span class="token punctuation">.</span><span class="token function">getModuleId</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>hotUpdateMainJson<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> source<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">hotModuleReplacement</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>assetInfo
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u5176\u4E2D<code>c</code>\u4EE3\u8868\u66F4\u65B0\u7684<code>chunk id</code>\uFF0C<code>r</code>\u4EE3\u8868\u79FB\u9664\u7684<code>chunk id</code>\uFF0C<code>m</code>\u4EE3\u8868\u79FB\u9664\u7684<code>module</code>\u3002</p><h3 id="_5-hooks-record" tabindex="-1">5. hooks.record <a class="header-anchor" href="#_5-hooks-record" aria-hidden="true">#</a></h3><p>\u6700\u7EC8\u4F1A\u8BB0\u5F55\u4E00\u4E9B<code>hash\u3001id</code>\u7B49\u76F8\u5173\u4FE1\u606F\uFF1A</p><div class="language-javascript"><pre><code>compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>record<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
  <span class="token string">&quot;HotModuleReplacementPlugin&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> records</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>records<span class="token punctuation">.</span>hash <span class="token operator">===</span> compilation<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> chunkGraph <span class="token operator">=</span> compilation<span class="token punctuation">.</span>chunkGraph<span class="token punctuation">;</span>
    records<span class="token punctuation">.</span>hash <span class="token operator">=</span> compilation<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
    records<span class="token punctuation">.</span>fullHashChunkModuleHashes <span class="token operator">=</span> fullHashChunkModuleHashes<span class="token punctuation">;</span>
    records<span class="token punctuation">.</span>chunkModuleHashes <span class="token operator">=</span> chunkModuleHashes<span class="token punctuation">;</span>
    records<span class="token punctuation">.</span>chunkHashes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    records<span class="token punctuation">.</span>chunkRuntime <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> chunk <span class="token keyword">of</span> compilation<span class="token punctuation">.</span>chunks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      records<span class="token punctuation">.</span>chunkHashes<span class="token punctuation">[</span>chunk<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> chunk<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
      records<span class="token punctuation">.</span>chunkRuntime<span class="token punctuation">[</span>chunk<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getRuntimeKey</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>runtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="\u5C0F\u7ED3-1" tabindex="-1">\u5C0F\u7ED3 <a class="header-anchor" href="#\u5C0F\u7ED3-1" aria-hidden="true">#</a></h3><p><code>HotModuleReplacementPlugin</code>\u7684\u4F5C\u7528\u5B9E\u9645\u4E0A\u6709\u4E09\u4E2A\uFF1A</p><ol><li>\u5904\u7406<code>module.hot.xxx</code>\u7B49<code>api</code>\uFF0C\u8F6C\u6362\u6210\u65B0\u7684\u4EE3\u7801\u3002</li><li>\u5BF9\u6BD4<code>hash</code>\u503C\uFF0C\u5224\u65AD\u51FA\u54EA\u4E9B<code>module/chunk</code>\u66F4\u65B0\u3002\u5C06\u66F4\u65B0\u7684\u6A21\u5757\u5355\u72EC\u751F\u6210\u4E00\u4E2A<code>chunk</code>\uFF0C\u5C06\u4EE3\u7801\u8F93\u51FA\u5230<code>xxx.hot-update.js</code>\u6587\u4EF6\u4E2D\u3002\u800C\u5C06\u66F4\u65B0\u7684\u4FE1\u606F\u8F93\u51FA\u5230<code>xxx.hot-update.json</code>\u6587\u4EF6\u4E2D\u3002</li><li>\u6DFB\u52A0<code>HotModuleReplacementRuntimeModule</code>\u6A21\u5757\uFF0C\u4F9B\u540E\u7EED\u89E6\u53D1\u66F4\u65B0\u3002</li></ol><h2 id="\u5EFA\u7ACB\u670D\u52A1\u7AEFserver" tabindex="-1">\u5EFA\u7ACB\u670D\u52A1\u7AEFserver <a class="header-anchor" href="#\u5EFA\u7ACB\u670D\u52A1\u7AEFserver" aria-hidden="true">#</a></h2><p><code>webpack</code>\u4E2D\u4F7F\u7528<code>express</code>\u4F5C\u4E3A\u670D\u52A1\u7AEF\u6846\u67B6\u4E3A\u6D4F\u89C8\u5668\u63D0\u4F9B\u670D\u52A1\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// \u5EFA\u7ACB server</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u68C0\u67E5\u8BF7\u6C42\u5934\u90E8\u4FE1\u606F</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupHostHeaderCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u521B\u5EFA server</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u76D1\u542C</span>
<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>listenOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u5728<code>express</code>\u7684\u57FA\u7840\u4E0A\uFF0C\u521B\u5EFA\u670D\u52A1\u7AEF\u7684<code>WebSocket</code>\uFF0C\u7528\u4E8E\u7ED9\u5BA2\u6237\u7AEF\u53D1\u9001\u4FE1\u606F\uFF1A</p><div class="language-javascript"><pre><code><span class="token function">createWebSocketServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>webSocketServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServerTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>webSocketServer<span class="token punctuation">.</span>implementation<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u56E0\u6B64\uFF0C\u670D\u52A1\u7AEF\u901A\u8FC7<code>express</code>\u4E3A\u5BA2\u6237\u7AEF\u63D0\u4F9B<code>api</code>\u670D\u52A1\uFF0C\u5E76\u901A\u8FC7<code>WebSocket</code>\u7ED9\u5BA2\u6237\u7AEF\u53D1\u9001\u4FE1\u606F\u3002</p><h2 id="webpack-dev-middleware" tabindex="-1">webpack-dev-middleware <a class="header-anchor" href="#webpack-dev-middleware" aria-hidden="true">#</a></h2><p>\u5728\u5411<code>express</code>\u53D1\u9001\u8BF7\u6C42\u65F6\uFF0C\u4F1A\u7ECF\u8FC7<code>webpack-dev-middleware</code>\u4E2D\u95F4\u4EF6\uFF0C\u5B83\u7684\u8C03\u7528\u5728<code>setupDevMiddleware</code>\u4E2D\uFF1A</p><div class="language-javascript"><pre><code><span class="token function">setupDevMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> webpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-dev-middleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>middleware <span class="token operator">=</span> <span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>devMiddleware
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>webpackDevMiddleware</code>\u65B9\u6CD5\u6838\u5FC3\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code>context<span class="token punctuation">.</span>watching <span class="token operator">=</span> context<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>watchOptions<span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _middleware<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// API</span>
</code></pre></div><p>\u4E00\u662F\u8C03\u7528<code>compiler.watch</code>\u65B9\u6CD5\u8FDB\u884C\u7F16\u8BD1\u5E76\u76D1\u542C\u6587\u4EF6\u53D8\u5316\uFF0C\u4E8C\u662F\u5E94\u7528<code>webpack-dev-middleware</code>\u4E2D\u95F4\u4EF6\u3002</p><p>\u5728\u7F16\u8BD1\u7684\u8FC7\u7A0B\u4E2D\u4F1A\u8C03\u7528\u524D\u9762\u63D0\u5230\u7684<code>HotModuleReplacementPlugin</code>\uFF0C\u5E76\u4E14\u7F16\u8BD1\u5B8C\u6210\u540E\u89E6\u53D1<code>hooks.done</code>\u94A9\u5B50\u3002\u800C\u5728<code>webpack-dev-server</code>\u4E2D\uFF0C\u76D1\u542C\u4E86<code>hooks.done</code>\u94A9\u5B50\uFF1A</p><div class="language-javascript"><pre><code><span class="token function">setupHooks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-dev-server&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7F16\u8BD1\u5B8C\u6210\uFF0C\u53D1\u9001\u7ED9 server websocket</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webSocketServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendStats</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>webSocketServer<span class="token punctuation">.</span>clients<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getStats</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stats <span class="token operator">=</span> stats<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6B64\u65F6\u4F1A\u901A\u8FC7\u670D\u52A1\u7AEF<code>server</code>\u5411\u6240\u6709\u5BA2\u6237\u7AEF\u53D1\u9001\u7F16\u8BD1\u5B8C\u6210\u7684\u6D88\u606F\uFF0C\u5982<code>&quot;ok&quot;</code>\u3002</p><p>\u6765\u5230<code>webpack-dev-server/client/index.js</code>\uFF0C\u6709\u63A5\u6536\u6D88\u606F\u7684\u56DE\u8C03\uFF1A</p><div class="language-javascript"><pre><code><span class="token function-variable function">ok</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>overlay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">reloadApp</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>\u6B64\u65F6\u89E6\u53D1<code>reloadApp</code>\u65B9\u6CD5\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>hot <span class="token operator">&amp;&amp;</span> allowToHot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hotEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;webpackHotUpdate&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">.</span>currentHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>\u6700\u7EC8\u89E6\u53D1<code>webpackHotUpdate</code>\u4E8B\u4EF6\uFF0C\u800C\u5728<code>webpack/hot/dev-server.js</code>\u6587\u4EF6\u4E2D\uFF0C\u76D1\u542C\u4E86\u8BE5\u4E8B\u4EF6\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">check</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>hot
      <span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">updatedModules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> hotEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./emitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hotEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;webpackHotUpdate&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">currentHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">upToDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;idle&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>\u6B64\u65F6\u4F1A\u8C03\u7528<code>module.hot.check(true)</code>\u65B9\u6CD5\u3002</p><h2 id="hotcheck" tabindex="-1">hotCheck <a class="header-anchor" href="#hotcheck" aria-hidden="true">#</a></h2><p><code>module.hot.check(true)</code>\u65B9\u6CD5\u5BF9\u5E94\u4E8E<code>webpack/lib/hmr/HotModuleReplacement.runtime.js</code>\u6587\u4EF6\u4E2D\u7684<code>hotCheck</code>\u65B9\u6CD5\uFF0C\u5B9E\u9645\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u7C7B\u4F3C\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">function</span> <span class="token function">hotCheck</span><span class="token punctuation">(</span><span class="token parameter">applyOnUpdate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;check&quot;</span><span class="token punctuation">)</span>
  	<span class="token comment">// 1. \u8BF7\u6C42 xxx-hot-update.json \u6587\u4EF6</span>
		<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>hmrM<span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">update</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;prepare&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">var</span> updatedModules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				blockingPromises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				currentUpdateApplyHandlers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token comment">// 2. \u8BF7\u6C42\u53D8\u66F4\u540E\u7684 chunks</span>
				<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
					Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>hmrC<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>
						<span class="token parameter">promises<span class="token punctuation">,</span>
						key</span>
					<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						__webpack_require__<span class="token punctuation">.</span>hmrC<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>
							update<span class="token punctuation">.</span>c<span class="token punctuation">,</span>
							update<span class="token punctuation">.</span>r<span class="token punctuation">,</span>
							update<span class="token punctuation">.</span>m<span class="token punctuation">,</span>
							promises<span class="token punctuation">,</span>
							currentUpdateApplyHandlers<span class="token punctuation">,</span>
							updatedModules
						<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">return</span> promises<span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
				<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token function">waitForBlockingPromises</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>applyOnUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 3. \u8FDB\u884C\u70ED\u66F4\u65B0\u5E94\u7528</span>
							<span class="token keyword">return</span> <span class="token function">internalApply</span><span class="token punctuation">(</span>applyOnUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token keyword">return</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token keyword">return</span> updatedModules<span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fullhash-hot-update-json" tabindex="-1">[fullhash].hot-update.json <a class="header-anchor" href="#fullhash-hot-update-json" aria-hidden="true">#</a></h3><p><code>__webpack_require__.hmrM</code>\u5BF9\u5E94\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">/* webpack/runtime/getFullHash */</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">h</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token string">&quot;a4c01381c6f871e5f847&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* webpack/runtime/get update manifest filename */</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">hmrF</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token string">&quot;index.&quot;</span> <span class="token operator">+</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.hot-update.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">hmrM</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fetch <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;No browser support: need fetch API&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">hmrF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// no update available</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to fetch update manifest &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>	
</code></pre></div><p>\u5B9E\u9645\u4E0A\u5B83\u662F\u6839\u636E<code>fullhash</code>\u6765\u62FC\u63A5\u66F4\u65B0\u4FE1\u606F\u7684\u8BF7\u6C42\u5730\u5740\uFF0C\u7136\u540E\u53D1\u9001\u8BF7\u6C42\u3002\u6B64\u65F6<code>express</code>\u63A5\u6536\u5230\u8BF7\u6C42\uFF0C\u901A\u8FC7<code>webpack-dev-middleware</code>\u4E2D\u95F4\u4EF6\uFF0C\u5728\u5185\u5B58\u4E2D\u8BFB\u53D6<code>[fullhash].hot-update.json</code>\u6587\u4EF6\uFF0C\u5E76\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002</p><h3 id="fullhash-hot-update-js" tabindex="-1">[fullhash].hot-update.js <a class="header-anchor" href="#fullhash-hot-update-js" aria-hidden="true">#</a></h3><p>\u62FF\u5230\u66F4\u65B0\u4FE1\u606F\u540E\uFF0C\u901A\u8FC7<code>__webpack_require__.hmrC</code>\u65B9\u6CD5\u52A0\u8F7D\u66F4\u65B0\u540E\u7684<code>chunk</code>\uFF1A</p><div class="language-javascript"><pre><code>__webpack_require__<span class="token punctuation">.</span>hmrC<span class="token punctuation">.</span><span class="token function-variable function">jsonp</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
 <span class="token parameter">chunkIds<span class="token punctuation">,</span>
 removedChunks<span class="token punctuation">,</span>
 removedModules<span class="token punctuation">,</span>
 promises<span class="token punctuation">,</span>
 applyHandlers<span class="token punctuation">,</span>
 updatedModulesList</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  applyHandlers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>applyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentUpdateChunks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  currentUpdateRemovedChunks <span class="token operator">=</span> removedChunks<span class="token punctuation">;</span>
  currentUpdate <span class="token operator">=</span> removedModules<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentUpdateRuntime <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  chunkIds<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">,</span> chunkId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u6839\u636E chunkId, \u52A0\u8F7D\u6700\u65B0\u7684 chunk</span>
      promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">loadUpdateChunk</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">,</span> updatedModulesList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      currentUpdateChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>\u5176\u4E2D<code>loadUpdateChunk</code>\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">/* webpack/runtime/get javascript update chunk filename */</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// This function allow to reference all chunks</span>
  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">hu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// return url for filenames based on template</span>
    <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> chunkId <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.hot-update.js&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">loadUpdateChunk</span><span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">hu</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    __webpack_require__<span class="token punctuation">.</span><span class="token function">l</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> loadingEnded<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6839\u636E<code>hot-update.json</code>\u6587\u4EF6\u4E2D\u7684<code>chunkId</code>\u52A0\u8F7D\u6700\u65B0\u7684<code>chunk</code>\u3002\u52A0\u8F7D\u5B8C\u6210\u540E\uFF0C\u5B9E\u9645\u662F\u52A0\u8F7D\u7684\u53D8\u66F4\u540E\u7684<code>module</code>\u4EE3\u7801\uFF0C\u7C7B\u4F3C\u5982\u4E0B\uFF1A</p><div class="language-javascript"><pre><code>self<span class="token punctuation">[</span><span class="token string">&quot;webpackHotUpdatestudy_webpack&quot;</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
  <span class="token comment">// chunk id</span>
  <span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// \u66F4\u65B0\u7684 module</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;./src/moduleB.js&quot;</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;xxxxx\u7701\u7565xxxxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// \u66F4\u65B0\u7684 runtime</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">__webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">h</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token string">&quot;23e988120ea958e8108f&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u800C\u5728\u5165\u53E3\u6587\u4EF6\u4E2D\uFF0C\u5B9A\u4E49\u4E86<code>webpackHotUpdatestudy_webpack</code>\uFF08\u8BE5\u53D8\u91CF\u540D\u79F0\u662F\u6839\u636E\u9879\u76EE\u540D\u79F0\u5B9A\u7684\uFF09\uFF1A</p><div class="language-javascript"><pre><code>self<span class="token punctuation">[</span><span class="token string">&quot;webpackHotUpdatestudy_webpack&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkId<span class="token punctuation">,</span> moreModules<span class="token punctuation">,</span> runtime</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>moreModules<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      currentUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUpdatedModulesList<span class="token punctuation">)</span> currentUpdatedModulesList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>runtime<span class="token punctuation">)</span> currentUpdateRuntime<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>runtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingUpdateResolves<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    waitingUpdateResolves<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    waitingUpdateResolves<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>\u6700\u7EC8\u66F4\u65B0\u7684<code>module</code>\u548C<code>runtime</code>\u4F1A\u8BB0\u5F55\u5230<code>currentUpdate</code>\u548C<code>currentUpdateRuntime</code>\u53D8\u91CF\u5F53\u4E2D\u3002</p><h2 id="hotapply" tabindex="-1">hotApply <a class="header-anchor" href="#hotapply" aria-hidden="true">#</a></h2><p>\u5F97\u5230\u66F4\u65B0\u540E\u7684\u4EE3\u7801\u540E\uFF0C\u63A5\u4E0B\u6765\u5C31\u9700\u8981\u6839\u636E\u7528\u6237\u5B9A\u4E49\u7684<code>module.hot.xxx</code>\u7B49<code>api</code>\u6765\u8FDB\u884C\u70ED\u66F4\u65B0\u4E86\u3002</p><h3 id="module-hot\u76F8\u5173api\u5B9A\u4E49" tabindex="-1">module.hot\u76F8\u5173api\u5B9A\u4E49 <a class="header-anchor" href="#module-hot\u76F8\u5173api\u5B9A\u4E49" aria-hidden="true">#</a></h3><div class="language-javascript"><pre><code><span class="token comment">// HotModuleReplacement.runtime.js \u6253\u5305\u540E</span>
__webpack_require__<span class="token punctuation">.</span>i<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> module <span class="token operator">=</span> options<span class="token punctuation">.</span>module<span class="token punctuation">;</span>
  <span class="token keyword">var</span> require <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>require<span class="token punctuation">,</span> options<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>hot <span class="token operator">=</span> <span class="token function">createModuleHotObject</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>id<span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>parents <span class="token operator">=</span> currentParents<span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  currentParents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  options<span class="token punctuation">.</span>require <span class="token operator">=</span> require<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u52A0\u8F7D\u6A21\u5757\u65F6\uFF0C\u4F1A\u6267\u884C __webpack_require__.i\uFF0C\u4E3A module.hot \u8D4B\u503C\u3002</span>
<span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> module <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
    <span class="token literal-property property">loaded</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> execOptions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span> <span class="token literal-property property">module</span><span class="token operator">:</span> module<span class="token punctuation">,</span> <span class="token literal-property property">factory</span><span class="token operator">:</span> __webpack_modules__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">require</span><span class="token operator">:</span> __webpack_require__ <span class="token punctuation">}</span><span class="token punctuation">;</span>
  __webpack_require__<span class="token punctuation">.</span>i<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">handler</span><span class="token punctuation">(</span>execOptions<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module <span class="token operator">=</span> execOptions<span class="token punctuation">.</span>module<span class="token punctuation">;</span>
  execOptions<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> execOptions<span class="token punctuation">.</span>require<span class="token punctuation">)</span><span class="token punctuation">;</span>

  module<span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u5728\u6A21\u5757\u52A0\u8F7D\u65F6\uFF0C\u6267\u884C<code>__webpack_require__.i</code>\uFF0C\u6B64\u65F6\u4F1A\u901A\u8FC7<code>createModuleHotObject</code>\u51FD\u6570\u521B\u5EFA<code>module.hot</code>\u5BF9\u8C61\u3002\u56E0\u6B64\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE\u5230<code>module.hot.xxx</code>\u5C5E\u6027\u3002</p><h3 id="applyinvalidatedmodules" tabindex="-1">applyInvalidatedModules <a class="header-anchor" href="#applyinvalidatedmodules" aria-hidden="true">#</a></h3><p>\u9996\u5148\u662F\u8C03\u7528<code>applyInvalidatedModules</code>\u65B9\u6CD5\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">function</span> <span class="token function">applyInvalidatedModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>queuedInvalidatedModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUpdateApplyHandlers<span class="token punctuation">)</span> currentUpdateApplyHandlers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>hmrI<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queuedInvalidatedModules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        __webpack_require__<span class="token punctuation">.</span>hmrI<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>
          moduleId<span class="token punctuation">,</span>
          currentUpdateApplyHandlers
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    queuedInvalidatedModules <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>queuedInvalidatedModules</code>\u662F\u5728\u8C03\u7528<code>module.hot.invalidate</code>\u65B9\u6CD5\u65F6\u6536\u96C6\u5230\u7684<code>module</code>\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// invalidate \u65B9\u6CD5\u8C03\u7528\u65F6\uFF0C\u6536\u96C6 moduleId</span>
<span class="token function-variable function">invalidate</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>currentStatus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;apply&quot;</span><span class="token operator">:</span>
      <span class="token punctuation">(</span>queuedInvalidatedModules <span class="token operator">=</span> queuedInvalidatedModules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        moduleId
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>\u5FAA\u73AF\u540E\u8C03\u7528\u7684\u662F<code>__webpack_require__.hmrI.jsonp</code>\uFF1A</p><div class="language-javascript"><pre><code>__webpack_require__<span class="token punctuation">.</span>hmrI<span class="token punctuation">.</span><span class="token function-variable function">jsonp</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleId<span class="token punctuation">,</span> applyHandlers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5982\u679C\u6A21\u5757\u6CA1\u6709\u66F4\u65B0</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentUpdate <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    currentUpdateRuntime <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    currentUpdateRemovedChunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    applyHandlers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>applyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5982\u679C\u66F4\u65B0\u7684\u6A21\u5757\u4E2D\u4E0D\u5305\u542B\u5F53\u524D\u6A21\u5757\uFF0C\u90A3\u4E48\u5C06\u8BE5\u6A21\u5757\u6DFB\u52A0\u5230\u66F4\u65B0\u6A21\u5757\u4E2D</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>currentUpdate<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> __webpack_require__<span class="token punctuation">.</span>m<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="applyhandler" tabindex="-1">applyHandler <a class="header-anchor" href="#applyhandler" aria-hidden="true">#</a></h3><p>\u63A5\u4E0B\u6765\u662F\u8C03\u7528<code>applyHandle</code>\uFF0C\u7528\u4E8E\u89E3\u6790</p><div class="language-javascript"><pre><code><span class="token keyword">var</span> results <span class="token operator">=</span> currentUpdateApplyHandlers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>applayHandle</code>\u7684\u5B9A\u4E49\u662F\u5728<code>webpack/lib/hmr/JavascriptHotModuleReplacement.runtime.js</code>\u6587\u4EF6\u4E2D\uFF1A</p><div class="language-javascript"><pre><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> moduleId <span class="token keyword">in</span> currentUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>currentUpdate<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newModuleFactory <span class="token operator">=</span> currentUpdate<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newModuleFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token function">getAffectedModuleEffects</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;disposed&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">moduleId</span><span class="token operator">:</span> moduleId
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>\u8BE5\u51FD\u6570\u4F1A\u904D\u5386\u66F4\u65B0\u7684<code>module</code>\uFF0C\u7136\u540E\u901A\u8FC7<code>getAffectedModuleEffects</code>\u65B9\u6CD5\u627E\u5230\u8BE5<code>module</code>\u8C03\u7528\u4E86<code>module.hot</code>\u7684\u5177\u4F53<code>api</code>\u3002\u6700\u540E\u7528<code>outdatedModules</code>\u8BB0\u5F55\u6240\u6709\u9700\u8981\u66F4\u65B0\u7684<code>module</code>\uFF0C\u7528<code>outdatedDependencies</code>\u8BB0\u5F55<code>parent</code>\u548C<code>children</code>\u4E4B\u95F4\u9700\u8981\u66F4\u65B0\u7684\u5173\u7CFB\uFF0C\u5982\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// outdatedModules</span>
<span class="token punctuation">[</span><span class="token string">&quot;./src/moduleB.js&quot;</span><span class="token punctuation">]</span>

<span class="token comment">// outdatedDependencies</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;./src/index.js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/moduleB.js&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span> 
</code></pre></div><h3 id="dispose" tabindex="-1">dispose <a class="header-anchor" href="#dispose" aria-hidden="true">#</a></h3><p>\u63A5\u7740\u901A\u8FC7<code>dispose</code>\u65B9\u6CD5\u79FB\u9664\u65E7\u7684<code>module</code>\u6216<code>chunk</code>\uFF1A</p><div class="language-javascript"><pre><code>results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>dispose<span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>\u7C7B\u4F3C\u5982\u4E0B\u64CD\u4F5C\uFF1A</p><div class="language-javascript"><pre><code><span class="token function-variable function">dispose</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u7701\u7565\u5176\u4ED6\u5185\u5BB9\u7684\u5220\u9664</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ....</span>
    <span class="token keyword">delete</span> __webpack_require__<span class="token punctuation">.</span>c<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> outdatedDependencies<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ....</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="apply" tabindex="-1">apply <a class="header-anchor" href="#apply" aria-hidden="true">#</a></h3><p>\u6700\u540E\u8C03\u7528<code>apply</code>\u65B9\u6CD5\u66F4\u65B0\u5185\u5BB9\uFF1A</p><div class="language-javascript"><pre><code><span class="token comment">// \u66F4\u65B0 module</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> updateModuleId <span class="token keyword">in</span> appliedUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>appliedUpdate<span class="token punctuation">,</span> updateModuleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __webpack_require__<span class="token punctuation">.</span>m<span class="token punctuation">[</span>updateModuleId<span class="token punctuation">]</span> <span class="token operator">=</span> appliedUpdate<span class="token punctuation">[</span>updateModuleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u66F4\u65B0 runtime</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> currentUpdateRuntime<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentUpdateRuntime<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u8C03\u7528 accept \u7684\u56DE\u8C03</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> outdatedModuleId <span class="token keyword">in</span> outdatedDependencies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>outdatedDependencies<span class="token punctuation">,</span> outdatedModuleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> __webpack_require__<span class="token punctuation">.</span>c<span class="token punctuation">[</span>outdatedModuleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      moduleOutdatedDependencies <span class="token operator">=</span>
        outdatedDependencies<span class="token punctuation">[</span>outdatedModuleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> dependenciesForCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> moduleOutdatedDependencies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> dependency <span class="token operator">=</span> moduleOutdatedDependencies<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> acceptCallback <span class="token operator">=</span>
            module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span>_acceptedDependencies<span class="token punctuation">[</span>dependency<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>acceptCallback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>callbacks<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>acceptCallback<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
          callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>acceptCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
          dependenciesForCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dependency<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> callbacks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u89E6\u53D1\u56DE\u8C03</span>
        callbacks<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> moduleOutdatedDependencies<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// module.hot.accept() =&gt; \u91CD\u65B0\u52A0\u8F7D\u81EA\u8EAB module</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>o <span class="token operator">&lt;</span> outdatedSelfAcceptedModules<span class="token punctuation">.</span>length<span class="token punctuation">;</span>o<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> item <span class="token operator">=</span> outdatedSelfAcceptedModules<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> moduleId <span class="token operator">=</span> item<span class="token punctuation">.</span>module<span class="token punctuation">;</span>
  item<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hash-\u66F4\u65B0" tabindex="-1">hash \u66F4\u65B0 <a class="header-anchor" href="#hash-\u66F4\u65B0" aria-hidden="true">#</a></h2><p>\u6BCF\u6B21\u8BF7\u6C42\u7684<code>json</code>\u6587\u4EF6\u90FD\u662F\u4E4B\u524D\u7F16\u8BD1\u7684<code>hash</code>\u3002\u7B49\u5230\u6A21\u5757\u52A0\u8F7D\u5B8C\u6BD5\uFF0C\u6839\u636E<code>runtime</code>\u66F4\u65B0\u5BF9\u5E94\u7684<code>hash</code>\u503C\u3002 <img src="`+p+'" alt=""></p><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>\u70ED\u66F4\u65B0\u6D41\u7A0B\u5982\u4E0B\uFF1A</p><ol><li><p><code>compiler.watch</code>\u76D1\u542C\u6587\u4EF6\u53D8\u5316\uFF0C\u5982\u679C\u53D8\u5316\uFF0C\u5F00\u59CB\u91CD\u65B0\u7F16\u8BD1\u3002</p></li><li><p>\u7F16\u8BD1\u8FC7\u7A0B\u4E2D\uFF1A</p><ol><li>\u9996\u5148\u65B0\u589E\u4E24\u4E2A<code>entry</code>\uFF1A\u4E00\u662F<code>WebSocket</code>\u7684\u5BA2\u6237\u7AEF\uFF0C\u7528\u4E8E\u63A5\u6536\u670D\u52A1\u7AEF\u7684\u901A\u77E5\uFF1B\u4E8C\u662F<code>webpack</code>\u7684<code>dev-server</code>\uFF0C\u7528\u4E8E\u76D1\u542C<code>webpackHotUpdate</code>\u4E8B\u4EF6\u3002</li><li>\u901A\u8FC7<code>HotModuleReplacementPlugin</code>\u63D2\u4EF6\uFF0C\u5BF9\u6BD4\u7F16\u8BD1\u540E\u7684<code>chunk</code>\u548C<code>module</code>\uFF0C\u5C06\u66F4\u65B0\u540E\u7684<code>module</code>\u548C<code>runtime</code>\u5F62\u6210\u65B0\u7684<code>HotUpdateChunk</code>\u3002\u6700\u7EC8\u5C06\u8BE5<code>chunk</code>\u8F93\u51FA\u5230<code>hot-update.js</code>\u6587\u4EF6\u4E2D\uFF0C\u800C\u5C06\u53D8\u5316\u7684\u4FE1\u606F\u8F93\u51FA\u5230<code>hot-update.json</code>\u6587\u4EF6\u4E2D\uFF08\u90FD\u5728\u5185\u5B58\u4E2D\uFF09\u3002</li><li>. <code>HotModuleReplacementPlugin</code>\u63D2\u4EF6\u8FD8\u4F1A\u4E3A<code>&quot;bundle&quot;</code>\u6DFB\u52A0\u5904\u7406\u66F4\u65B0\u7684\u4EE3\u7801 \u2014\u2014 <code>HotModuleReplacement.runtime.js</code>\u548C<code>JavascriptHotModuleReplacement.runtime.js</code>\u6587\u4EF6\u3002<code>module.hot</code>\u7B49<code>api</code>\u5747\u5728\u8FD9\u91CC\u5B9A\u4E49\u3002</li></ol></li><li><p>\u7F16\u8BD1\u5B8C\u6210\u540E\uFF0C\u89E6\u53D1<code>hooks.done</code>\u94A9\u5B50\u3002<code>webpack-dev-server</code>\u63A5\u6536\u5230\u7F16\u8BD1\u5B8C\u6210\u4E8B\u4EF6\uFF0C\u901A\u8FC7\u670D\u52A1\u7AEF<code>server</code>\u5411\u5BA2\u6237\u7AEF\u53D1\u9001\u66F4\u65B0\u901A\u77E5\u3002</p></li><li><p>\u5BA2\u6237\u7AEF\u63A5\u6536\u5230\u670D\u52A1\u7AEF\u901A\u77E5\uFF0C\u8C03\u7528<code>reloadApp</code>\u65B9\u6CD5\u89E6\u53D1<code>webpackHotUpdate</code>\u4E8B\u4EF6\uFF0C<code>webpack</code>\u7684<code>dev-server</code>\u76D1\u542C\u5230\u8BE5\u4E8B\u4EF6\u3002</p></li><li><p>\u5BA2\u6237\u7AEF\u5F00\u59CB\u8FDB\u884C<code>hotCheck</code>\uFF1A</p><ol><li>\u6839\u636E<code>fullhash</code>\u901A\u8FC7<code>fetch</code>\u5411<code>express</code>\u8BF7\u6C42<code>hot-update.json</code>\u6587\u4EF6\u3002</li><li>\u6839\u636E<code>hot-update.json</code>\u4E2D\u6539\u53D8\u7684<code>chunk</code>\u7684<code>id</code>\uFF0C\u8BF7\u6C42\u5BF9\u5E94\u7684<code>hot-update.js</code>\u6587\u4EF6\u3002</li><li>\u6267\u884C<code>hot-update.js</code>\u6587\u4EF6\u4E2D\u7684\u4EE3\u7801\uFF0C\u5C06\u66F4\u65B0\u540E\u7684<code>module</code>\u548C<code>runtime</code>\u5B58\u5230<code>currentUpdate</code>\u548C<code>currentUpdateRuntime</code>\u4E2D\u3002</li></ol></li><li><p>\u5BA2\u6237\u7AEF\u5F00\u59CB\u8FDB\u884C<code>hotApply</code>\uFF1A</p><ol><li>\u904D\u5386<code>currentUpdate</code>\uFF0C\u6839\u636E\u7528\u6237\u5B9A\u4E49\u7684<code>module.hot</code>\u76F8\u5173\u7684<code>api</code>\uFF0C\u786E\u8BA4\u66F4\u65B0\u7684<code>module</code>\u548C<code>runtime</code>\u3002</li><li>\u8C03\u7528<code>dispose</code>\u65B9\u6CD5\uFF0C\u904D\u5386\u5F85\u66F4\u65B0\u7684<code>module</code>\uFF0C\u79FB\u9664\u539F\u6709\u7684<code>module</code>\u5B9A\u4E49\u3002</li><li>\u8C03\u7528<code>apply</code>\u65B9\u6CD5\uFF0C\u6DFB\u52A0\u5F85\u66F4\u65B0\u7684<code>module</code>\u7684\u6700\u65B0\u5B9A\u4E49\uFF0C\u5E76\u89E6\u53D1<code>module.hot.accept</code>\u56DE\u8C03\u3002</li></ol></li></ol>',138),c=[e];function u(l,k,i,r,d,h){return a(),s("div",null,c)}var w=n(o,[["render",u]]);export{f as __pageData,w as default};
