import{_ as e,o as a,c as o,a as c}from"./app.5a1d1f50.js";const _=JSON.parse('{"title":"不同版本 React 事件触发顺序不一致问题","description":"","frontmatter":{},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"原因","slug":"原因","link":"#原因","children":[]},{"level":2,"title":"React 为什么要将事件从 document 改为 rootNode？","slug":"react-为什么要将事件从-document-改为-rootnode","link":"#react-为什么要将事件从-document-改为-rootnode","children":[]},{"level":2,"title":"为什么需要合成事件？","slug":"为什么需要合成事件","link":"#为什么需要合成事件","children":[]}],"relativePath":"react/note/event-change.md","lastUpdated":1694075415000}'),t={name:"react/note/event-change.md"},d=c(`<h1 id="不同版本-react-事件触发顺序不一致问题" tabindex="-1">不同版本 React 事件触发顺序不一致问题 <a class="header-anchor" href="#不同版本-react-事件触发顺序不一致问题" aria-hidden="true">#</a></h1><h2 id="背景" tabindex="-1">背景 <a class="header-anchor" href="#背景" aria-hidden="true">#</a></h2><p>在开发弹出面板时，需要在 body/document 上绑定事件判断是否需要隐藏打开的面板。最后发现不同版本的 react 表现行为不一致。</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#BABED8;">document.addEventListener(&#39;click&#39;, xxx)  // 原生事件</span></span>
<span class="line"><span style="color:#BABED8;">document.body.addEventListener(&#39;click&#39;, xxx)  // 原生事件 </span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onClick</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">{xxx}</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#BABED8;"> // React 合成事件</span></span>
<span class="line"></span></code></pre></div><p>在 <code>React16</code> 时，执行顺序为 <code>body =&gt; div =&gt; document</code></p><p>在 <code>React17</code>/18 时，执行顺序为 <code>div =&gt; body =&gt; document</code></p><h1 id="不同版本react事件触发顺序不一致问题" tabindex="-1">不同版本React事件触发顺序不一致问题 <a class="header-anchor" href="#不同版本react事件触发顺序不一致问题" aria-hidden="true">#</a></h1><h2 id="原因" tabindex="-1">原因 <a class="header-anchor" href="#原因" aria-hidden="true">#</a></h2><p><code>React 16</code> 事件委托到 <code>document</code> 上，<code>react 17+</code> 委托到 <code>rootNode</code> 上：</p><p><img src="https://img-blog.csdnimg.cn/f00c7bb1f3114b1c9e5a64c31c5e6292.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5p-S5ZCb,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt=""></p><p>在 16 的情况下，先冒泡到 <code>body</code>，触发 <code>body</code>。再冒泡到 <code>document</code>，触发 <code>document</code> 上绑定的合成事件，再触发绑定在 <code>document</code> 上的原生事件。可以通过 <code>e.nativeEvent.stopImmediatePropagation</code> 阻止 <code>document</code> 上的原生事件触发。</p><p>在 17+ 的情况下，先冒泡到 <code>rootNode</code>，触发合成事件，再冒泡到 <code>body =&gt; document</code> 。</p><h1 id="不同版本react事件触发顺序不一致问题-1" tabindex="-1">不同版本React事件触发顺序不一致问题 <a class="header-anchor" href="#不同版本react事件触发顺序不一致问题-1" aria-hidden="true">#</a></h1><h2 id="react-为什么要将事件从-document-改为-rootnode" tabindex="-1">React 为什么要将事件从 document 改为 rootNode？ <a class="header-anchor" href="#react-为什么要将事件从-document-改为-rootnode" aria-hidden="true">#</a></h2><p>如果存在多个版本的 <code>React</code> 组件嵌套时，如果冒泡到 <code>document</code>，可能存在一个版本的组件 <code>e.stopPropagation()</code> 影响到另外一个版本组件（其他的事件行为可能也会被影响）。</p><p>如果改为 <code>rootNode</code>，不同版本的 <code>react</code> 组件间事件就不会相互影响。</p><h1 id="不同版本react事件触发顺序不一致问题-2" tabindex="-1">不同版本React事件触发顺序不一致问题 <a class="header-anchor" href="#不同版本react事件触发顺序不一致问题-2" aria-hidden="true">#</a></h1><h2 id="为什么需要合成事件" tabindex="-1">为什么需要合成事件？ <a class="header-anchor" href="#为什么需要合成事件" aria-hidden="true">#</a></h2><ol><li>内部做了浏览器事件兼容。</li><li>减少绑定卸载事件的开销。</li><li>统一管理事件，比如更新优先级可以在这里统一设置。</li></ol>`,19),n=[d];function s(r,l,i,p,h,m){return a(),o("div",null,n)}const g=e(t,[["render",s]]);export{_ as __pageData,g as default};
